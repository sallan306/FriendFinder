<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reservation Page</title>

  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="./css/survey.css">  

</head>
<body>

  <div class="container">

    <div class="jumbotron">
      <h1 class="text-center"><span class="fa fa-fire"></span> Kindling</h1>
      <hr>
      <h2 class="text-center">Find a spark for the fire!</h2>
      <br>

      <div class="text-center">
        <a href="/"><button class="btn btn-lg btn-default"><span class="fa fa-home"> Return to Main Menu</span></button></a>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">

        <!-- Reservation Page -->
        <div class="panel panel-default">
          <h4 class="panel-title text-center">Basic Information</h4>
          <br>
          <div class="panel-body">

            <form role="form">

                <input class="form-control" id="userName" type="text" placeholder="Your name">
                <br>
                <input class="form-control" id="userLink" type="text" placeholder="URL for a picture of yourself">
                <br>
                <div class="panel-heading">
                  <h4 class="panel-title text-center">Psychoanalytics Section:</h4>
                      <p class="text-center">In this section we will gague your unique personality 
                          identifiers to match you with the best possible person! Please
                          answer truthfully and be mindful of your answers. Good Luck!</p>
                </div>
                <h6>Do you like Nature?</h6>
                <select class="form-control form-control-sm" id="question1">
                    <!-- <option></option> -->
                    <option value="1">Strongly Disagree</option>
                    <option value="2">Disagree</option>
                    <option value="3">Indifferent</option>
                    <option value="4">Agree</option>
                    <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like science?</h6>
                <select class="form-control form-control-sm" id="question2">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like sports?</h6>
                <select class="form-control form-control-sm" id="question3">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like painting?</h6>
                <select class="form-control form-control-sm" id="question4">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like politics?</h6>
                <select class="form-control form-control-sm" id="question5">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like cooking?</h6>
                <select class="form-control form-control-sm" id="question6">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like comic books?</h6>
                <select class="form-control form-control-sm" id="question7">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like working out?</h6>
                <select class="form-control form-control-sm" id="question8">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like fantasy?</h6>
                <select class="form-control form-control-sm" id="question9">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>
                </select>
                <h6>Do you like romance?</h6>
                <select class="form-control form-control-sm" id="question10">
                        <!-- <option></option> -->
                        <option value="1">Strongly Disagree</option>
                        <option value="2">Disagree</option>
                        <option value="3">Indifferent</option>
                        <option value="4">Agree</option>
                        <option value="5">Strongly Agree</option>   
                </select>


              <button type="submit" class="btn btn-primary text-center submit">Submit</button>
            </form>

          </div>
        </div>

      </div>
    </div>


    <footer class="footer">
    </footer>

  </div>

</body>
</html>

<!-- BELOW CODE IS CRITICAL. IT HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">
var tableData = {}
var serverData = []

$(".submit").on("click", function(event) {
  event.preventDefault();
  tableData = 
    {
    name: $('#userName').val(),
    image: $("#userLink").val(),
    scores: [ 
      parseInt($('#question1').val()),
      parseInt($("#question2").val()),
      parseInt($("#question3").val()),
      parseInt($("#question4").val()),
      parseInt($("#question5").val()),
      parseInt($("#question6").val()),
      parseInt($("#question7").val()),
      parseInt($("#question8").val()),
      parseInt($("#question9").val()),
      parseInt($("#question10").val()) ]
    }

  
  $.post("/api/reserve", tableData,
    function(data) {
      $.get("/api/reserve",function(data){
              //console.log("input GOT!")
              //console.log(data)
              serverData = data;
            console.log(serverData)
            console.log(tableData)
            console.log(serverData[0].scores.length)
            console.log(tableData.scores.length)
            compareMatches(serverData,tableData)
            
      })
  })
});
function compareMatches(server,user) {
  var compare = 0
  var results = []
  for (let i = 0;i<server.length;i++) {
    console.log("serverLength "+ server.length)
    for (let j = 0;j<server[i].scores.length;j++) {
      if (server[i].scores[j] >= user.scores[j]) {
          compare += (server[i].scores[j] - user.scores[j])
          console.log("server: " +server[i].scores[j] + " minus user "+ user.scores[j])
      }
      else {
        compare += (user.scores[j] - server[i].scores[j])
        console.log("j: "+j+"i: " +i+" user: " +user.scores[j] + " minus server "+ server[i].scores[j])
      }
    }
    console.log("compare: "+compare)
    results.push(compare)
    compare = 0
    
  }
  console.log(results)

  var matchedNumber = Math.min.apply(null, results)
  // console.log("lowest number in array: "+matchedNumber)
  var matchedIndex = results.indexOf(matchedNumber);
  // console.log("match index: "+matchedIndex)
  var match = server[matchedIndex]
  // console.log(match.name)
  $(".panel").html("<p class='text-center'> your match is: "+match.name+"</p>")
  // console.log("<img src='"+match.image+"'>")
  $(".panel").append("<img width = '100%' src='"+match.image+"'>")
}
</script>
